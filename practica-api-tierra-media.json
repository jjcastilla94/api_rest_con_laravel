{
  "info": {
    "name": "Tierra Media API - Corrección",
    "_postman_id": "b7f4b9c4-1234-4567-8901-acdeffedcba0",
    "description": "Colección de corrección para la práctica de API REST con Laravel (Tierra Media)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "base_url", "value": "http://localhost/api" },
    { "key": "region_id", "value": "" },
    { "key": "realm_id", "value": "" },
    { "key": "hero_id", "value": "" },
    { "key": "artifact_id", "value": "" },
    { "key": "creature_id", "value": "" }
  ],
  "item": [
    {
      "name": "01 - Regiones",
      "item": [
        {
          "name": "Crear región",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{base_url}}/regions", "host": ["{{base_url}}"], "path": ["regions"] },
            "body": {
              "mode": "raw",
              "raw": "{ \"name\": \"Eriador\" }"
            }
          },
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "pm.test('Status 201 o 200', () => pm.response.to.have.status.oneOf([200,201]));",
                "pm.environment.set('region_id', pm.response.json().id);"
              ]
            }
          }]
        },
        {
          "name": "Listar regiones",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/regions", "host": ["{{base_url}}"], "path": ["regions"] }
          },
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "pm.test('Respuesta es array', () => pm.expect(pm.response.json()).to.be.an('array'));"
              ]
            }
          }]
        }
      ]
    },
    {
      "name": "02 - Reinos",
      "item": [
        {
          "name": "Crear reino",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{base_url}}/realms", "host": ["{{base_url}}"], "path": ["realms"] },
            "body": {
              "mode": "raw",
              "raw": "{ \"name\": \"Gondor\", \"ruler\": \"Aragorn\", \"alignment\": \"Bien\", \"id_region\": {{region_id}} }"
            }
          },
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "pm.test('Reino creado', () => pm.response.to.have.status.oneOf([200,201]));",
                "pm.environment.set('realm_id', pm.response.json().id);"
              ]
            }
          }]
        },
        {
          "name": "Detalle reino con relaciones",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/realms/{{realm_id}}",
              "host": ["{{base_url}}"],
              "path": ["realms", "{{realm_id}}"]
            }
          },
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "const json = pm.response.json();",
                "pm.test('Incluye región', () => pm.expect(json).to.have.property('region'));",
                "pm.test('Incluye héroes', () => pm.expect(json).to.have.property('heroes'));"
              ]
            }
          }]
        }
      ]
    },
    {
      "name": "03 - Héroes",
      "item": [
        {
          "name": "Crear héroe",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{base_url}}/heroes", "host": ["{{base_url}}"], "path": ["heroes"] },
            "body": {
              "mode": "raw",
              "raw": "{ \"name\": \"Boromir\", \"race\": \"Humano\", \"rank\": \"Capitán\", \"realm_id\": {{realm_id}}, \"alive\": true }"
            }
          },
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "pm.test('Héroe creado', () => pm.response.to.have.status.oneOf([200,201]));",
                "pm.environment.set('hero_id', pm.response.json().id);"
              ]
            }
          }]
        },
        {
          "name": "Héroes vivos",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/heroes/alive", "host": ["{{base_url}}"], "path": ["heroes","alive"] }
          },
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "pm.response.json().forEach(h => pm.expect(h.alive).to.eql(true));"
              ]
            }
          }]
        }
      ]
    },
    {
      "name": "04 - Artefactos y relación N:N",
      "item": [
        {
          "name": "Crear artefacto",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{base_url}}/artifacts", "host": ["{{base_url}}"], "path": ["artifacts"] },
            "body": {
              "mode": "raw",
              "raw": "{ \"name\": \"Cuerno de Gondor\", \"type\": \"Objeto\", \"origin_realm_id\": {{realm_id}}, \"power_level\": 70, \"description\": \"Señal de auxilio\" }"
            }
          },
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "pm.test('Artefacto creado', () => pm.response.to.have.status.oneOf([200,201]));",
                "pm.environment.set('artifact_id', pm.response.json().id);"
              ]
            }
          }]
        },
        {
          "name": "Asignar artefacto a héroe",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "url": { "raw": "{{base_url}}/artifact-hero", "host": ["{{base_url}}"], "path": ["artifact-hero"] },
            "body": {
              "mode": "raw",
              "raw": "{ \"hero_id\": {{hero_id}}, \"artifact_id\": {{artifact_id}} }"
            }
          },
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "pm.test('Asignación correcta', () => pm.response.to.have.status.oneOf([200,201]));"
              ]
            }
          }]
        },
        {
          "name": "Artefactos de un héroe",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/heroes/{{hero_id}}/artifacts",
              "host": ["{{base_url}}"],
              "path": ["heroes","{{hero_id}}","artifacts"]
            }
          },
          "event": [{
            "listen": "test",
            "script": {
              "exec": [
                "pm.test('Devuelve array', () => pm.expect(pm.response.json()).to.be.an('array'));"
              ]
            }
          }]
        }
      ]
    }
  ]
}
